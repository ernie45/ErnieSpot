YUI.add("hermes-template-photo-list-photo-interaction",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return e.escapeExpression(e.lambda((s=t!=null?t.photo:t)!=null?s.title:s,t))},3:function(e,t,n,r,i){return e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.UNTITLED"},data:i}))},5:function(e,t,n,r,i){return" "+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.BY_YOU"},data:i}))},7:function(e,t,n,r,i){var s;return" "+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{user:(s=(s=t!=null?t.photo:t)!=null?s.owner:s)!=null?s.username:s,intlName:"common.BY_USER"},data:i}))},9:function(e,t,n,r,i){var s,o=t!=null?t:{};return'		<div class="extra-tools">\n'+((s=n["if"].call(o,t!=null?t.removeToolClass:t,{name:"if",hash:{},fn:e.program(10,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.bigScotchTitle:t,{name:"if",hash:{},fn:e.program(12,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.moreMenuItems:t,{name:"if",hash:{},fn:e.program(14,i,0),inverse:e.noop,data:i}))!=null?s:"")+"		</div>\n"},10:function(e,t,n,r,i){var s,o,u=e.escapeExpression;return'				<div class="extra-tool remove-photo '+u((o=(o=n.removeToolClass||(t!=null?t.removeToolClass:t))!=null?o:n.helperMissing,typeof o=="function"?o.call(t!=null?t:{},{name:"removeToolClass",hash:{},data:i}):o))+'" data-id='+u(e.lambda((s=t!=null?t.photo:t)!=null?s.id:s,t))+"></div>\n"},12:function(e,t,n,r,i){var s,o,u=e.escapeExpression;return'				<div class="extra-tool big-scotch" data-id='+u(e.lambda((s=t!=null?t.photo:t)!=null?s.id:s,t))+' title="'+u((o=(o=n.bigScotchTitle||(t!=null?t.bigScotchTitle:t))!=null?o:n.helperMissing,typeof o=="function"?o.call(t!=null?t:{},{name:"bigScotchTitle",hash:{},data:i}):o))+'"></div>\n'},14:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression;return'				<div class="extra-tool more-menu" data-menu-items="'+f((o=(o=n.moreMenuItems||(t!=null?t.moreMenuItems:t))!=null?o:a,typeof o=="function"?o.call(u,{name:"moreMenuItems",hash:{},data:i}):o))+'" data-id='+f(e.lambda((s=t!=null?t.photo:t)!=null?s.id:s,t))+' title="'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.MORE"},data:i}))+'"></div>\n'},16:function(e,t,n,r,i){return" narrow"},18:function(e,t,n,r,i){var s,o=t!=null?t:{};return((s=n["if"].call(o,(s=t!=null?t.photo:t)!=null?s.title:s,{name:"if",hash:{},fn:e.program(19,i,0),inverse:e.program(21,i,0),data:i}))!=null?s:"")+((s=n["if"].call(o,(s=(s=t!=null?t.photo:t)!=null?s.owner:s)!=null?s.displayname:s,{name:"if",hash:{},fn:e.program(23,i,0),inverse:e.program(29,i,0),data:i}))!=null?s:"")},19:function(e,t,n,r,i){var s,o,u=e.escapeExpression;return'					<a href="'+u((o=(o=n.photoPageUrl||(t!=null?t.photoPageUrl:t))!=null?o:n.helperMissing,typeof o=="function"?o.call(t!=null?t:{},{name:"photoPageUrl",hash:{},data:i}):o))+'" class="title" tabindex="-1">'+u(e.lambda((s=t!=null?t.photo:t)!=null?s.title:s,t))+"</a>\n"},21:function(e,t,n,r,i){return'					<span class="title empty"> </span>\n'},23:function(e,t,n,r,i){var s;return'					<a href="'+e.escapeExpression(e.lambda((s=(s=t!=null?t.photo:t)!=null?s.owner:s)!=null?s.url:s,t))+'" class="attribution">\n'+((s=(n.photoAttribution||t&&t.photoAttribution||n.helperMissing).call(t!=null?t:{},t!=null?t.photo:t,t!=null?t.flippers:t,{name:"photoAttribution",hash:{},fn:e.program(24,i,0),inverse:e.noop,data:i}))!=null?s:"")+"					</a>\n"},24:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.intlName:t,{name:"if",hash:{},fn:e.program(25,i,0),inverse:e.program(27,i,0),data:i}))!=null?s:""},25:function(e,t,n,r,i){return"								"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{user:t!=null?t.user:t,intlName:t!=null?t.intlName:t},data:i}))+"\n"},27:function(e,t,n,r,i){var s;return"								"+e.escapeExpression((s=(s=n.user||(t!=null?t.user:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"user",hash:{},data:i}):s))+"\n"},29:function(e,t,n,r,i){return'					<span class="attribution empty"> </span>\n'},31:function(e,t,n,r,i){return'				<span class="title empty"> </span>\n				<span class="attribution empty"> </span>\n'},33:function(e,t,n,r,i){var s,o,u=t!=null?t:{};return'		<div class="tool'+((s=n["if"].call(u,t!=null?t.isNarrow:t,{name:"if",hash:{},fn:e.program(34,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n			<a href="'+e.escapeExpression((o=(o=n.photoPageUrl||(t!=null?t.photoPageUrl:t))!=null?o:n.helperMissing,typeof o=="function"?o.call(u,{name:"photoPageUrl",hash:{},data:i}):o))+'" class="fave-area" '+((s=n["if"].call(u,t!=null?t.isFaved:t,{name:"if",hash:{},fn:e.program(36,i,0),inverse:e.program(38,i,0),data:i}))!=null?s:"")+" "+((s=n.unless.call(u,t!=null?t.canFave:t,{name:"unless",hash:{},fn:e.program(40,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n				<i class="fave-star'+((s=n["if"].call(u,t!=null?t.isFaved:t,{name:"if",hash:{},fn:e.program(42,i,0),inverse:e.program(44,i,0),data:i}))!=null?s:"")+((s=n.unless.call(u,t!=null?t.canFave:t,{name:"unless",hash:{},fn:e.program(46,i,0),inverse:e.noop,data:i}))!=null?s:"")+'"></i>'+((s=n["if"].call(u,t!=null?t.faveCount:t,{name:"if",hash:{},fn:e.program(48,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n			</a>\n		</div>\n"},34:function(e,t,n,r,i){return" lonely"},36:function(e,t,n,r,i){return'aria-label="'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"fave-view.UNFAVE_PHOTO"},data:i}))+'"'},38:function(e,t,n,r,i){return'aria-label="'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.ADD_TO_FAVORITES"},data:i}
))+'"'},40:function(e,t,n,r,i){return'tabindex="-1"'},42:function(e,t,n,r,i){return" faved"},44:function(e,t,n,r,i){return" fave"},46:function(e,t,n,r,i){return" can-not-fave"},48:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.faveCount:t,{name:"if",hash:{},fn:e.program(49,i,0),inverse:e.noop,data:i}))!=null?s:""},49:function(e,t,n,r,i){var s;return'<span class="icon-count">'+e.escapeExpression((s=(s=n.faveCount||(t!=null?t.faveCount:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"faveCount",hash:{},data:i}):s))+"</span>"},51:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression;return'		<div class="tool">\n			<a href="'+f((o=(o=n.photoPageUrl||(t!=null?t.photoPageUrl:t))!=null?o:a,typeof o=="function"?o.call(u,{name:"photoPageUrl",hash:{},data:i}):o))+'#comments" class="comment-area" aria-label="'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PLURAL_COMMENT"},data:i}))+'">\n				<i class="comments"></i>'+((s=n["if"].call(u,t!=null?t.commentCount:t,{name:"if",hash:{},fn:e.program(52,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n			</a>\n		</div>\n"},52:function(e,t,n,r,i){var s;return'<span class="icon-count">'+e.escapeExpression((s=(s=n.commentCount||(t!=null?t.commentCount:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"commentCount",hash:{},data:i}):s))+"</span>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{};return'<div class="photo-list-photo-interaction">\n	<a class="overlay" href="'+e.escapeExpression((o=(o=n.photoPageUrl||(t!=null?t.photoPageUrl:t))!=null?o:n.helperMissing,typeof o=="function"?o.call(u,{name:"photoPageUrl",hash:{},data:i}):o))+'" tabindex="0" role="heading" aria-level="3" aria-label="'+((s=n["if"].call(u,(s=t!=null?t.photo:t)!=null?s.title:s,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+((s=n["if"].call(u,(s=t!=null?t.photo:t)!=null?s.isOwner:s,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:"")+'"></a>\n'+((s=n["if"].call(u,t!=null?t.hasExtraFunctionality:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i}))!=null?s:"")+'	<div class="interaction-bar'+((s=n["if"].call(u,t!=null?t.isNarrow:t,{name:"if",hash:{},fn:e.program(16,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" title="'+((s=n["if"].call(u,(s=t!=null?t.photo:t)!=null?s.title:s,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+((s=n["if"].call(u,(s=t!=null?t.photo:t)!=null?s.isOwner:s,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:"")+'">\n		<div class="text">\n'+((s=n["if"].call(u,t!=null?t.displayTitleAndAttribution:t,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.program(31,i,0),data:i}))!=null?s:"")+"		</div>\n\n"+((s=n["if"].call(u,t!=null?t.displayFaveIcon:t,{name:"if",hash:{},fn:e.program(33,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+((s=n["if"].call(u,t!=null?t.displayComments:t,{name:"if",hash:{},fn:e.program(51,i,0),inverse:e.noop,data:i}))!=null?s:"")+"	</div>\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-list-photo-interaction",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-list-photo-interaction-view",function(e,t){var n=require("lib/helpers/type-validator"),r=require("lib/flog")(t);"use strict";var i=300,s={css:{faveClickArea:".fave-area",commentClickArea:".comment-area",removeFaveTool:"remove-fave",removePoolTool:"remove-group-pool",removeShowCasePhoto:"remove-showcase-photo",removePhotosOfYou:"remove-photosof-you",scotchTool:"scotch-photo"}},o=50,u=20,a=12,f=20;e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){var t=this.appContext.getViewer();return this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),(!t.signedIn||e.nsid!==t.nsid)&&this.set("viewingSelf",!1),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),e.photoPageUrl&&this.set("photoPageUrl",e.photoPageUrl),this.params=e,this},loadState:function(){var t=[],n=this.get("listModelParams");return t.push(this.appContext.getModel(this.get("engagementModelName"),this.get("id"))),n&&t.push(this.appContext.getModel(n.registryName,n.modelIdOrAttributes)),e.Promise.all(t).then(function(e){var t=e[0],n=e[1];this.set("engagement",t),this.extraFunctionality={moreMenuItems:[]},this.params.removeOwnFaves?this.get("model").getValue("isOwner")&&!this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=s.css.removeFaveTool):this.params.removePoolPhoto?this.get("model").getValue("isOwner")?this.extraFunctionality.removeToolClass=s.css.removePoolTool:n&&(n.getValue("group").getValue("isAdmin")||n.getValue("group").getValue("isModerator"))&&(this.extraFunctionality.removeToolClass=s.css.removePoolTool):this.params.scotch?this.extraFunctionality.removeToolClass=s.css.scotchTool:this.params.removeShowCasePhoto?this.get("model").getValue("isOwner")&&this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=s.css.removeShowCasePhoto):this.params.removePhotosOfYou&&this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=s.css.removePhotosOfYou),this.params.excludePeople&&this.extraFunctionality.moreMenuItems.push("exclude-people"),this.params.banUser&&n&&(n.getValue("group").getValue("isAdmin")||n.getValue("group").getValue("isModerator"))&&this.extraFunctionality.moreMenuItems.push("ban-user"),this.params.removeUser&&n&&(n.getValue("group").getValue("isAdmin")||n.getValue("group").getValue("isModerator"))&&this.extraFunctionality.moreMenuItems.push("remove-user"),this.params.searchSimilar&&this.extraFunctionality.moreMenuItems.push("search-similar"),this.params.searchSimilarWithTerm&&this.extraFunctionality.moreMenuItems.push("search-similar-with-term"),this.params.bigScotch&&(this.extraFunctionality.bigScotchTitle=this.godMessage({intlName:"explore.DO_BIG_SCOTCH"})),this.extraFunctionality.moreMenuItems=this.extraFunctionality.moreMenuItems.join(",")}.bind(this))},buildContainer:function(t){var n=this.get("engagement"),r=n.getValue("faveCount"),i=n.getValue("isFaved"),s=n.getValue("canFave"),l=n.getValue("commentCount"),c=18,h=8,p=17,d=c*2+h*2+p,v=!0,m=!0,g,y=!0,b=!0;return r>=100?d+=o:r>=10?d+=u:r>0&&(d+=a),g=d-c,l>=100?d+=o:l>=10?d+=u:l>0&&(d+=a),this.get("layoutWidth")-d<f&&(v=!1),this.get("layoutWidth")<=d&&(m=!1),this.get("layoutWidth")<=g&&(y=!1),this.get("layoutWidth")<=c+6&&(b=!1),t=t||{},r=y?e.flutil.formatNumbers(r):null,l=e.flutil.formatNumbers(l),t.photo=this.get("model").toJSON(),t.photoPageUrl=this.get("photoPageUrl"),t.faveCount=r,t.isFaved=i,t.canFave=s,t.commentCount=l,t.displayTitleAndAttribution=v,t.displayComments=m,t.displayFaveIcon=b,t.isNarrow=!m&&!y,t.hasExtraFunctionality=Object.keys(this.extraFunctionality).length>0,t.removeToolClass=this.extraFunctionality.removeToolClass,t.moreMenuItems=this.extraFunctionality.moreMenuItems,t.bigScotchTitle=this.extraFunctionality.bigScotchTitle,this.setContainerWithTemplate("photo-list-photo-interaction",t),this},activate:function(){var e=this.appContext.getViewer(),t=this.get("engagement"),n=this.get("container");return this.get("engagement").getValue("canFave")&&(this.registerEventHandler(t.on("valuesChanged",this.faveStarChanged.bind(this))),this.registerEventHandler(n.delegate("click",this.faveStarClicked.bind(this),s.css.faveClickArea))),this.signedOutTest&&(!e||!e.signedIn)&&this.registerEventHandler(n.delegate("click",this.commentClicked.bind(this),s.css.commentClickArea)),this},commentClicked:function(t){var n=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_TITLE"}),r=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_MESSAGE"}),i,s=this.get("engagement"),o,u=this;t.halt(),e.rapidTracker.beacon(u.name,"commentIconClick"),o=e.url(e.URLHelper.getPhotoPage({photoId:s.getValue("id"),pathAlias:s.getValue("ownerNsid")})),i=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-comment",signUpTitle:n,signUpMessage:r,beaconPrefix:"comment"}),i.on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("comment",{postLoginUrl:o})}),i.on("signInClick",function(t){e.SigninHelper._redirectToSignin("comment",{postLoginUrl:o})}),i.show()},showSignUpAndFaveModal:function(t,n){var r=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),i=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"}),s;s=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:r,signUpMessage:i,beaconPrefix:"fave"}),s.on("signUpClick",function(r){e.SigninHelper.signUpPendingFave({id:t},{postLoginUrl:n})}),s.on("signInClick",function(r){e.SigninHelper.addPendingFave({id:t},{postLoginUrl:n})}),s.show()},faveStarClicked:function(t){var n=this.appContext.getViewer(),r=this.get("engagement"),i=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_MESSAGE"}),s=this.intlMessage({intlName:"fave-view.SIGN_IN_AND_FAVE"}),o=this.intlMessage({intlName:"common.CANCEL"}),u,a,f,l=this;t.halt(),e.rapidTracker.beacon(this.name,"faveButtonClick");if(n&&n.signedIn)this.get("isFaving")||(this.set("isFaving",!0),r.
toggleFave(),r.remoteUpdate().then(function(){this.appContext.getModelRegistry("favorite-models").then(function(e){e.proxy(n.nsid).getValue("photoPageList").remove(l.get("model"))}),this.set("isFaving",!1)}.bind(this),function(e){e.code!==3&&r.toggleFave(),this.set("isFaving",!1)}.bind(this)));else{a=r.getValue("id"),f=e.url(e.URLHelper.getPhotoPage({photoId:a,pathAlias:r.getValue("ownerNsid")}));if(this.signedOutTest)return this.showSignUpAndFaveModal(a,f);u=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),htmlMessage:i,actionButtonLabel:s,cancelButtonLabel:o}),u.on("actionClick",function(){e.rapidTracker.beacon(l.name,"faveModalSigninClick"),e.SigninHelper.addPendingFave({id:a},{postLoginUrl:f})}),u.on("cancelClick",function(t){e.rapidTracker.beacon(l.name,"faveModalCancelClick")}),u.show()}t.halt()},faveStarChanged:function(e){(e.faveCount!==undefined||e.isFaved!==undefined||e.canFave!==undefined)&&this.buildContainer()},destructor:function(){}},{ATTRS:{id:{writeOnce:"initOnly",validator:function(e,t){return n.photoId(e)}},model:{writeOnce:"initOnly"},listModelParams:{writeOnce:"initOnly"},photoPageUrl:{writeOnce:"initOnly"},engagement:{value:null},viewingSelf:{value:!0},engagementModelName:{writeOnce:"initOnly",value:null,validator:function(t,n){return e.AttributeHelpers.validateString(t)}},layoutWidth:{validator:function(t,n){return e.AttributeHelpers.validateFloat(t)},setter:function(t){return e.AttributeHelpers.coerceFloat(t)||undefined},defaultFn:function(e){return 0}},isFaving:{value:!1,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-list-photo-interaction","attribute-helpers","fluid-modal-view","fluid-droparound-view","url"],optionalRequires:["fluid"],langBundles:["fave-view","common","photo-page-scrappy"]});
YUI.add("hermes-lang-fave-view",function(e,t){e.Intl.add("hermes/fave-view","en-US",{COULDNT_FAVE:["We couldn't fave at this time"],SIGN_IN_TO_FAVE:["You must be signed in to fave. Please sign in now."],LOADING_FAVES:["Loading Faves..."],UNFAVE_PHOTO:["Unfave this photo"],FAVE_PHOTO:["Fave this photo"],WHO_FAVED:["Who faved this photo"],SIGN_IN_BEFORE_FAVE_TITLE:["You found a photo to fave!"],SIGN_IN_BEFORE_FAVE_MESSAGE:["That's great. Just sign in to fave it."],SIGN_IN_AND_FAVE:["Sign in and fave"],JOIN_FLICKR_AND_FAVE:["Join Flickr to add this photo to your favorites."]})},"@VERSION@",{requires:["intl"]});
